<?php	require_once 'classes/Membership.php';	$membership = New Membership();	$membership->confirm_Member();	require_once("../lib/siteconfig.php");		foreach($_POST as $nombre_campo => $valor){	   $asignacion = "\$" . $nombre_campo . "='" . cleanQuery($valor) . "';";	   eval($asignacion);	}		$Mensaje='';	if(isset($funcion)) {		switch($funcion){			case add:				if(mysql_query("INSERT INTO tbl_users (USR_Username,USR_Password,USR_Displayname,USR_email,USR_Activo) VALUES ('$inp_username','$inp_password','$inp_displayname','$inp_email','1');")){					$Mensaje= "Usuario agregado.....";				}				else{						$Mensaje= "Error: ".mysql_error();				}				break;			case edit:				if(mysql_query("UPDATE tbl_users SET USR_Username='$inp_username',USR_Displayname='$inp_displayname',USR_email='$inp_email' WHERE USR_ID='$inp_userid';")){					if($inp_password !== "XXXXX"){						$inp_password=md5($inp_password);						mysql_query("UPDATE tbl_users SET USR_Password='$inp_password' WHERE USR_ID='$inp_userid';");					}					$Mensaje= "Usuario Modificado.....";				}				else{					$Mensaje= "Error:".mysql_error();					}				break;			case del:				if(mysql_query("DELETE FROM tbl_users WHERE USR_ID='$inp_userid';")){					$Mensaje= "Usuario Borrado.....";				}				else{						$Mensaje= "Error: ".mysql_error();				}				break;			case activar:				$usr_result=mysql_query("SELECT * FROM tbl_users WHERE USR_ID='$inp_userid';");				if(mysql_num_rows($usr_result) == 1){					$row = mysql_fetch_assoc($usr_result);					if(trim($row["USR_Activo"]) == 1){						$res=mysql_query("UPDATE tbl_users SET USR_Activo=0 WHERE USR_ID='$inp_userid';");						$Mensaje= "Usuario Desactivado";					}else{						$res=mysql_query("UPDATE tbl_users SET USR_Activo=1 WHERE USR_ID='$inp_userid';");						$Mensaje= "Usuario Activado";					}				}				else{						$Mensaje= "El usuario no existe";				}				break;		}	}?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-type" content="text/html; charset=utf-8" />	<link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">	<link rel="icon" href="../favicon.ico" type="image/x-icon">    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" charset="utf-8">    <link rel="stylesheet" href="../css/aproahp.css" type="text/css" media="screen" charset="utf-8">	<link rel="stylesheet" href="css/jquery-ui.css" type="text/css" media="screen" charset="utf-8">	<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8">	<title>Web oficial de Aproahp(Página de Administración)</title></head><body><div id="container"><div id="mensaje" style="display:none"><?=$Mensaje?></div><?php require("header.php")?><!-- inicio content --><div id='usuarios'>	<h3>Usuarios</h3><br/>	<div id="adduser" >Agregar Usuario</div>	<div id='usuariosform'>		<div id="loader" style="display:none"><img style="margin: 50px auto;position: relative;display: block;" src="../images/ajax-loader.gif" alt="Esperando Datos"></div>		<form id='frm_user' method='post' action='<?=$paginaactual?>'>		<table>			<tr><td><label for="inp_username">Usuario:</label></td><td><input type='text' name='inp_username' id='inp_username' maxlength='32' class='text ui-widget-content ui-corner-all'></td></tr>			<tr><td><label for="inp_Displayname">Nombre:</label></td><td><input type='text' name='inp_displayname' maxlength='50' id='inp_displayname' class='text ui-widget-content ui-corner-all'></td></tr>			<tr><td><label for="inp_email">Correo:</label></td><td><input type='text' name='inp_email' id='inp_email' maxlength='50' class='text ui-widget-content ui-corner-all'></td></tr>			<tr><td><label for="inp_password">Password:</label></td><td><input type='password' name='inp_password' id='inp_password' maxlength='32' class='text ui-widget-content ui-corner-all'></td></tr>		</table>		<input type="hidden" name="inp_userid" id="inp_userid" value="">		<input type="hidden" name="funcion" id="funcion" value="">		</form>	</div><?php		echo "<div id='usuarioslist'><table class='ui-widget ui-widget-content'>";		echo "<thead  class='ui-widget-header'><td>Acciones</td><td>Usuario</td><td>Nombre</td><td>Email</td></thead>";		$usr_result=mysql_query("SELECT * FROM tbl_users ORDER BY USR_Displayname;");		for ($x = 0, $numrows = mysql_num_rows($usr_result); $x < $numrows; $x++) {  			$row = mysql_fetch_assoc($usr_result);			echo "<tr><td><div class='edit' rel='".$row["USR_ID"]."'>Editar</div><div class=borrar rel='".$row["USR_ID"]."'>Borrar</div><div rel='".$row["USR_ID"]."' class=activar";			if(trim($row["USR_Activo"]) =="1") echo ">Desactivar"; else echo ">Activar";			echo"</div></td><td>".$row["USR_username"]."</td><td>".$row["USR_Displayname"]."</td><td>".$row["USR_email"]."</td></tr>";	    }		echo "</table></div>";?></div><!-- fin div noticias --></div><!-- fin content --><?php require("../footer.html")?><script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript" charset="utf-8"></script><script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.9/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script><script src="../js/jquery.validate.js" type="text/javascript" charset="utf-8"></script><script src="../js/script.js" type="text/javascript" charset="utf-8"></script><script type="text/javascript">$(function() {	if($('#mensaje').html()!=''){		console.log($('#mensaje').html());		$('#mensaje').fadeTo(500, 1).fadeTo(1000, 0);	}	$("#frm_user").validate({	  rules: {	    inp_username: {	      required: true,	      maxlength: 32	    },	    inp_displayname: {	      required: true,	      maxlength: 50	    },	    inp_email: {	      required: true,	      email: true,	      maxlength: 50	    },	    inp_password: {	      required: true,	      minlength: 4,	      maxlength: 32	    }	  },	});		$( "#usuariosform" ).dialog({		autoOpen: false,		height: 300,		width: 650,		modal: true,		beforeClose: function(event, ui) {			$('form :input').val('')		},		close: function() {		}	});		$('#adduser').button().click(function() {		$( "#usuariosform" ).dialog({			title: "Agregar Nuevo Usuario",			buttons: {				"Agregar usuario": function() {					$('#funcion').val('add');					if ( $("#frm_user").valid() ) {						$("#frm_user").submit();						$( this ).dialog( "close" );					}				},				"Cancelar": function() {					$( this ).dialog( "close" );				}			}		});		$( "#usuariosform" ).dialog( "open" );	});	$('.borrar').live('click',function(){		var botonborrar= $(this);		var $dialog = $('<div></div>')			.html('<p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>El Usuario sera borrado, ¿esta usted seguro?</p>')			.dialog({			resizable: false,			height:180,			modal: true,			title:'¿Borrar?',			buttons: {				"Borrar": function() {					$.post("usuarios.php", { funcion: 'del',inp_userid: botonborrar.attr('rel')},						function( data ) {							$("#usuarioslist table").html( $( data ).find( '#usuarioslist table' ) );						}					);					$( this ).dialog( "close" );				},				"Cancelar": function() {					$( this ).dialog( "close" );				}			}		});	});	$('.edit').live('click',function(){		var userid = $(this).attr('rel');		$.ajax({			url: 'json.php',			type: 'POST',			dataType: 'json',			data:({requestuserdata : userid}),			beforeSend:function(){				$( "#usuariosform form" ).hide();				$("#loader").show();			},			success:function(data){				if(data.status == 'Ok'){					$("#inp_username").val(data.Username);					$("#inp_displayname").val(data.DisplayName);					$("#inp_email").val(data.email);					$("#inp_password").val("XXXXX");				}else{					alert("error consultando datos".data.message);				}			},			complete:function(){				$("#loader").hide();				$( "#usuariosform form" ).show();			}		});		$( "#usuariosform" ).dialog({				title: "Modificar Usuario",				buttons: {					"Editar usuario": function() {						$('#funcion').val('edit');						$('#inp_userid').val(userid);		        		if ( $("#frm_user").valid() ) {							$("#frm_user").submit();							$( this ).dialog( "close" );		        		}    				},    				"Cancelar": function() {						$( this ).dialog( "close" );					}    			}		});		$( "#usuariosform" ).dialog( "open" );	});		$('.activar').live('click',function(){		$.post('usuarios.php', 			{ funcion: 'activar',inp_userid: $(this).attr('rel') },		  	function( data ) {		    	$("#usuarioslist table").html( $( data ).find( '#usuarioslist table' ) );		});	});});</script></body></html>